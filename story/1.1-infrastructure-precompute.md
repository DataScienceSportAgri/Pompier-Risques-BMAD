# Story 1.1 : Infrastructure et script unique de pré-calcul

**Status:** Draft  
**Epic:** Epic 1 - Pré-calculs  
**Story Number:** 1.1

---

## Story

**As a** développeur,  
**I want** un script unique qui lance tous les pré-calculs, la même config que l'app, et les dossiers dédiés,  
**so that** les pré-calculs sont reproductibles en une commande.

---

## Acceptance Criteria

1. Dossiers `scripts/`, `data/source_data/`, `config/` créés. **Un seul script** (ex. `scripts/run_precompute.py`) appelle tous les calculs (distances, vecteurs statiques, microzones, etc.).
2. **Config** : **Un seul fichier** config partagé (ex. `config/*.yaml`) pour pré-calculs et application.
3. **Lancer une partie seulement** : possibilité documentée (README + script) — **argument CLI** (ex. `--skip-distances` pour n'exécuter que 1.3) et/ou **section config** pour activer/désactiver des blocs.
4. `requirements.txt` (ou `requirements-precompute.txt`) avec deps ; README : lancement, sorties, usage des arguments/section.
5. Format des pickles : **laissé au choix de l'implémentation**.

---

## Integration Verification

IV1: `scripts/` et `data/source_data/` n'écrasent pas `src/`, `docs/`, `brainstorming/`.  
IV2: Imports OK dans l'env Conda. Lancement partiel (argument et/ou section config) documenté et vérifiable.

---

## Tasks / Subtasks

- [ ] Créer structure de dossiers (scripts/, data/source_data/, config/)
- [ ] Créer fichier config YAML partagé (config/config.yaml)
- [ ] Créer script orchestration (scripts/run_precompute.py)
- [ ] Implémenter arguments CLI pour lancement partiel (--skip-*)
- [ ] Implémenter section config pour activer/désactiver blocs
- [ ] Créer requirements.txt ou requirements-precompute.txt
- [ ] Documenter README (lancement, sorties, arguments)
- [ ] Tests : vérifier structure dossiers, imports, lancement partiel

---

## Dev Notes

### Architecture Context

- Structure du projet : Monorepo avec séparation claire entre pré-calculs (scripts/) et application (src/)
- Config partagée : Un seul fichier YAML pour pré-calculs et application (cf. contraintes techniques PRD)
- Format pickle : Format laissé au choix de l'implémentation (pas de contrainte stricte)

### Source Tree

```
Pompier-Risques-BMAD/
├── config/                 # Fichiers config (YAML)
├── scripts/                # Pré-calculs (avant runs)
│   ├── run_precompute.py   # Script unique qui orchestre tous les pré-calculs
│   ├── precompute_distances.py
│   └── ...
├── data/
│   └── source_data/        # Sortie scripts pré-calcul (vecteurs de base, proportions, distances)
```

### Testing Standards

- Tests unitaires : Vérifier création dossiers, parsing config, arguments CLI
- Tests d'intégration : Vérifier lancement complet et partiel
- Framework : pytest (recommandé dans PRD)
- Emplacement : `tests/scripts/` ou `tests/precompute/`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 28 Jan 2026 | 1.0 | Création story | PM |
