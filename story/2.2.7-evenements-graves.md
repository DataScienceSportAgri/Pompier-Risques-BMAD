# Story 2.2.7 : Événements graves modulables (Accident, Incendie, Agression)

**Status:** Draft  
**Epic:** Epic 2 - Système de Simulation et Prédiction  
**Story Number:** 2.2.7

---

## Story

**As a** système de simulation,  
**I want** générer événements graves avec caractéristiques probabilistes,  
**so that** la complexité pour le ML est suffisante (effets locaux, ricochets, patterns).

---

## Acceptance Criteria

1. Classes `AccidentGrave`, `IncendieGrave`, `AgressionGrave` (héritant de `EventGrave`). Caractéristiques : Traffic slowdown, Cancel sports, Increase bad vectors, Kill pompier (probas et durées selon spec).
2. **Moment de génération** : **juste après** les vecteurs (dans la boucle jour-à-jour). Effets : stress long-terme, pattern court-terme, transitions régimes ; durée 3–10 j ; propagation spatiale (microzone, voisins, gravité décroissante).
3. **Matrices de génération** : les événements peuvent **modifier** les matrices (effets locaux, par ricochet) ; patterns et saisonnalité les modulent aussi.
4. Tests unitaires : caractéristiques, effets temporels/spatiaux.

---

## Integration Verification

IV1: Événements graves modifient les vecteurs (augmentation) ; probabilités respectées.  
IV2: Propagation spatiale et temporelle conforme.

---

## Tasks / Subtasks

- [ ] Implémenter classes `AccidentGrave`, `IncendieGrave`, `AgressionGrave` (héritant `EventGrave`)
- [ ] Implémenter caractéristiques probabilistes (Traffic slowdown, Cancel sports, Increase bad vectors, Kill pompier)
- [ ] Implémenter génération événements graves (juste après vecteurs)
- [ ] Implémenter effets temporels (durée 3-10 jours)
- [ ] Implémenter effets spatiaux (propagation microzone, voisins, gravité décroissante)
- [ ] Implémenter modification matrices (effets locaux, ricochets)
- [ ] Implémenter modulation par patterns et saisonnalité
- [ ] Tests : caractéristiques, effets temporels/spatiaux

---

## Dev Notes

### Architecture Context

- **Événements graves** : AccidentGrave, IncendieGrave, AgressionGrave (FR13)
- **Caractéristiques probabilistes** : Traffic slowdown, Cancel sports, Increase bad vectors, Kill pompier
- **Moment génération** : Juste après les vecteurs (dans boucle jour-à-jour)
- **Effets** : Stress long-terme, pattern court-terme, transitions régimes
- **Durée** : 3-10 jours
- **Propagation spatiale** : Microzone, voisins, gravité décroissante
- **Modification matrices** : Effets locaux, ricochets, modulation patterns/saisonnalité

### Source Tree

```
src/core/events/
├── event.py                  # Base Event (ABC)
├── event_grave.py           # EventGrave (ABC)
├── accident_grave.py        # AccidentGrave
├── incendie_grave.py       # IncendieGrave
└── agression_grave.py       # AgressionGrave

src/core/events/
└── event_factory.py         # Factory création événements
```

### Dependencies

- Event base : Story 2.1.1 (classes de base)
- Vecteurs : Story 2.2.1 (génération après vecteurs)
- Patterns : Story 2.2.2 (modulation)
- Matrices : Story 2.2.9 (modification matrices)

### Caractéristiques probabilistes

- **Traffic slowdown** : Probabilité, durée, effet
- **Cancel sports** : Probabilité, durée
- **Increase bad vectors** : Probabilité, augmentation, durée, radius
- **Kill pompier** : Probabilité (rare)

### Testing Standards

- Tests unitaires : Caractéristiques, effets temporels/spatiaux
- Tests de validation : Probabilités respectées, propagation conforme
- Framework : pytest
- Emplacement : `tests/core/events/`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 28 Jan 2026 | 1.0 | Création story | PM |
