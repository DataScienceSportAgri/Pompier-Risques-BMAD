# Story 2.1.4 : Système centralisé de résolution de chemins

**Status:** Draft  
**Epic:** Epic 2 - Système de Simulation et Prédiction  
**Story Number:** 2.1.4

---

## Story

**As a** développeur,  
**I want** un système centralisé de résolution de chemins avec convention de nommage,  
**so that** tous les chemins du projet sont cohérents et faciles à maintenir.

---

## Acceptance Criteria

1. **Convention de nommage** : Définie et documentée pour tous les types de fichiers (pickles, JSON, YAML, etc.).
2. **Système de résolution** : Classe ou module centralisé pour résoudre chemins relatifs à la racine du projet.
3. **Chemins relatifs** : Tous les chemins sont relatifs à la racine du projet (pas de chemins absolus hardcodés).
4. **Format pickle standardisé** : Format standardisé pour tous les fichiers pickle (structure, métadonnées, version).
5. **Documentation** : Convention de nommage et système de résolution documentés.
6. Tests unitaires : Résolution chemins, convention nommage, format pickle.

---

## Integration Verification

IV1: Tous les chemins du projet utilisent le système centralisé.  
IV2: Format pickle standardisé respecté partout.

---

## Tasks / Subtasks

- [x] Définir convention de nommage (pickles, JSON, YAML, etc.)
- [x] Créer système de résolution chemins centralisé (classe ou module)
- [x] Implémenter résolution chemins relatifs à racine projet
- [x] Définir format pickle standardisé (structure, métadonnées, version)
- [x] Implémenter helpers sauvegarde/chargement pickle (format standardisé)
- [x] Documenter convention nommage et système résolution
- [x] Tests : résolution chemins, convention nommage, format pickle

---

## Dev Notes

### Architecture Context

- **Chemins relatifs** : Tous relatifs à la racine du projet (contraintes techniques PRD)
- **Convention nommage** : Standardisée pour faciliter maintenance
- **Format pickle standardisé** : Structure, métadonnées, version pour compatibilité

### Source Tree

```
src/core/utils/
├── path_resolver.py          # Système résolution chemins
└── pickle_utils.py           # Helpers pickle format standardisé

docs/
└── philosophy-pickle-format.md  # Philosophie format pickle standardisé

examples/
└── pickle_format_example.py     # Exemple utilisation format pickle
```

### Convention de nommage (exemple)

```
# Pickles
data/source_data/{nom}_{version}.pkl
data/intermediate/run_{XXX}/{type}/{nom}.pkl
data/models/{algo}_{numero}_{params}.joblib

# JSON
data/patterns/{pattern_name}.json
data/intermediate/run_{XXX}/trace.json

# YAML
config/config.yaml
```

### Format pickle standardisé

**Voir `docs/philosophy-pickle-format.md` pour la philosophie complète.**

Structure standardisée :
```python
{
    'data': ...,  # Données réelles
    'metadata': {
        'version': '1.0',        # Version format pickle
        'created_at': datetime,  # Timestamp création
        'run_id': str,          # ID run (si applicable)
        'description': str,     # Description courte
        'type': str,            # Type données (ex: "vectors", "congestion")
        'schema_version': str   # Version schéma (optionnel)
    }
}
```

**Exemple d'utilisation** : Voir `examples/pickle_format_example.py`

### Testing Standards

- Tests unitaires : Résolution chemins, convention nommage, format pickle
- Tests de validation : Format pickle respecté, chemins cohérents
- Framework : pytest
- Emplacement : `tests/core/utils/`

---

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (via Cursor)

### Completion Notes
- ✅ Convention de nommage définie et documentée dans `docs/naming-conventions.md`
- ✅ PathResolver créé : système centralisé de résolution de chemins relatifs à la racine du projet
- ✅ Détection automatique de la racine du projet (README.md + config/config.yaml)
- ✅ Méthodes helper pour chemins courants : data_source(), data_patterns(), data_intermediate(), data_models(), config_file(), scripts_dir()
- ✅ Format pickle standardisé implémenté : structure avec 'data' et 'metadata' (version, created_at, type, description, run_id, schema_version)
- ✅ Helpers pickle : save_pickle(), load_pickle(), get_pickle_metadata(), create_pickle_data()
- ✅ Validation au chargement : vérification structure, type, version
- ✅ Documentation complète : naming-conventions.md et exemple d'utilisation (pickle_format_example.py)
- ✅ Tests unitaires complets : PathResolver (résolution, conventions), pickle_utils (format standardisé, validation)

### File List
**Nouveaux fichiers créés :**
- `src/core/utils/__init__.py`
- `src/core/utils/path_resolver.py` - Système centralisé de résolution de chemins
- `src/core/utils/pickle_utils.py` - Helpers pickle format standardisé
- `docs/naming-conventions.md` - Documentation convention de nommage
- `examples/pickle_format_example.py` - Exemples d'utilisation
- `tests/core/utils/__init__.py`
- `tests/core/utils/test_path_resolver.py` - Tests PathResolver
- `tests/core/utils/test_pickle_utils.py` - Tests pickle format standardisé

**Fichiers modifiés :**
- Aucun (nouveau module)

### Debug Log References
Aucune erreur critique. PathResolver et pickle_utils validés avec succès.

### Status
Ready for Review

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 28 Jan 2026 | 1.0 | Création story | PM |
| 29 Jan 2026 | 1.1 | Implémentation complète - Système centralisé de résolution de chemins et format pickle standardisé | Dev (James) |
