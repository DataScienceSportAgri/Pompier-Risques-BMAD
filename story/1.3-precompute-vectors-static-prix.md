# Story 1.3 : Pré-calcul vecteurs statiques et prix m²

**Status:** Draft  
**Epic:** Epic 1 - Pré-calculs  
**Story Number:** 1.3

---

## Story

**As a** système de simulation,  
**I want** vecteurs statiques (3×3 par microzone) et prix m² pré-calculés,  
**so that** le moteur J+1 et la règle prix m² (Epic 2) s'appuient sur des données fixes.

---

## Acceptance Criteria

1. Sous-partie du script unique : vecteurs statiques (3×3 par microzone) à partir des patterns Paris (`data/patterns/` ou défaut).
2. **Prix m²** : **source trouvée sur internet** ou **génération** à partir de connaissances (ex. par arrondissement / microzone). Intégrée ou produite par script.
3. Sorties dans `data/source_data/` (pickle ; format au choix).
4. **Ordre** : Les vecteurs statiques peuvent être calculés **sans** les distances (Story 1.2) ; pas de dépendance obligatoire 1.3 → 1.2.
5. Vérifications : dimensions et plages cohérentes.

---

## Integration Verification

IV1: Artefacts chargés sans erreur.  
IV2: Aucun conflit avec `data/intermediate/` (runs Epic 2).

---

## Tasks / Subtasks

- [ ] Identifier source prix m² (internet ou génération)
- [ ] Implémenter calcul vecteurs statiques (3×3 par microzone)
- [ ] Charger patterns Paris depuis `data/patterns/` (ou utiliser défaut)
- [ ] Implémenter génération prix m² (si pas de source internet)
- [ ] Sauvegarder vecteurs statiques en pickle
- [ ] Sauvegarder prix m² en pickle
- [ ] Tests : vérifier dimensions (3×3 par microzone), plages cohérentes

---

## Dev Notes

### Architecture Context

- **Vecteurs statiques** : 3 vecteurs (agressions, incendies, accidents) × 3 valeurs (bénin, moyen, grave) par microzone
- **Interface patterns Paris** : Vecteurs statiques servent d'interface entre patterns Paris et modèle (Story 2.2.10)
- **Prix m²** : Utilisé pour règle prix m² (FR17) : `prob_agression_modulée = prob_agression_base / facteur_prix_m2`
- **Ordre** : Pas de dépendance avec Story 1.2 (distances) - peut être calculé indépendamment

### Source Tree

```
scripts/
├── run_precompute.py
└── precompute_vectors_static.py  # Module pour cette story

data/
├── source_data/
│   ├── vecteurs_statiques.pkl
│   └── prix_m2.pkl
└── patterns/  # Patterns Paris (lecture)
```

### Dependencies

- Pandas : Manipulation données
- NumPy : Calculs vectoriels (si nécessaire)

### Testing Standards

- Tests unitaires : Vérifier dimensions vecteurs statiques (3×3 par microzone), plages prix m²
- Tests de validation : Cohérence données (pas de valeurs négatives, plages raisonnables)
- Framework : pytest
- Emplacement : `tests/scripts/test_precompute_vectors_static.py`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 28 Jan 2026 | 1.0 | Création story | PM |
