# Story 2.2.8 : Événements positifs et règle prix m²

**Status:** Draft  
**Epic:** Epic 2 - Système de Simulation et Prédiction  
**Story Number:** 2.2.8

---

## Story

**As a** système de simulation,  
**I want** générer événements positifs et appliquer la règle prix m²,  
**so that** travaux, casernes, etc. et corrélations socio-économiques sont reflétés.

---

## Acceptance Criteria

1. Événements positifs (Fin travaux, Nouvelle caserne, Amélioration matériel) ; **génération en début de journée** (avant vecteurs).
2. **Effets** : **réduction des intensités** et amélioration des transitions (pas d'« annulation » binaire des négatifs ; modulation).
3. **Prix m²** : `facteur_prix_m2 = prix_m2_microzone / prix_m2_moyen_paris` ; `prob_agression_modulée = prob_agression_base / facteur_prix_m2` ; diminution des probabilités Détérioration/Crise si prix m² élevé. Données depuis pré-calculs (Epic 1).
4. Tests unitaires : effets positifs, modulation agressions et régimes.

---

## Integration Verification

IV1: Événements positifs réduisent bien les intensités ; règle prix m² appliquée.  
IV2: Données prix m² chargées correctement (depuis `data/source_data/`).

---

## Tasks / Subtasks

- [ ] Implémenter événements positifs (Fin travaux, Nouvelle caserne, Amélioration matériel)
- [ ] Implémenter génération événements positifs (début de journée, avant vecteurs)
- [ ] Implémenter effets événements positifs (réduction intensités, amélioration transitions)
- [ ] Implémenter chargement prix m² depuis `data/source_data/` (Epic 1, Story 1.3)
- [ ] Implémenter calcul facteur prix m² (`prix_m2_microzone / prix_m2_moyen_paris`)
- [ ] Implémenter modulation probabilités agressions (`prob_agression_base / facteur_prix_m2`)
- [ ] Implémenter diminution probabilités Détérioration/Crise si prix m² élevé
- [ ] Tests : effets positifs, modulation agressions et régimes

---

## Dev Notes

### Architecture Context

- **Événements positifs** : Fin travaux, Nouvelle caserne, Amélioration matériel (FR14)
- **Génération** : Début de journée (avant vecteurs)
- **Effets** : Réduction intensités, amélioration transitions (modulation, pas annulation binaire)
- **Règle prix m²** : Modulation probabilités agressions et régimes (FR17)
- **Prix m²** : Données pré-calculées Epic 1, Story 1.3

### Source Tree

```
src/core/events/
├── positive_event.py        # PositiveEvent (ABC)
├── fin_travaux.py          # FinTravaux
├── nouvelle_caserne.py     # NouvelleCaserne
└── amelioration_materiel.py # AmeliorationMateriel

data/source_data/
└── prix_m2.pkl             # Prix m² pré-calculés (Epic 1, Story 1.3)
```

### Dependencies

- PositiveEvent base : Story 2.1.1 (classes de base)
- Prix m² : Epic 1, Story 1.3 (données pré-calculées)
- Régimes : Story 2.2.1 (modification probabilités Détérioration/Crise)
- Intensités : Story 2.2.1 (réduction intensités)

### Formule prix m²

```python
# Facteur prix m²
facteur_prix_m2 = prix_m2_microzone / prix_m2_moyen_paris

# Modulation probabilités agressions
prob_agression_modulée = prob_agression_base / facteur_prix_m2

# Diminution probabilités régimes si prix m² élevé
if facteur_prix_m2 > 1.2:  # Quartier riche
    prob_deterioration *= 0.8
    prob_crise *= 0.7
```

### Testing Standards

- Tests unitaires : Effets positifs, modulation agressions et régimes
- Tests de validation : Règle prix m² appliquée correctement
- Framework : pytest
- Emplacement : `tests/core/events/`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 28 Jan 2026 | 1.0 | Création story | PM |
