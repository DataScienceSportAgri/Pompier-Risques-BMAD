# Story 2.2.2 : Vecteurs alcool/nuit et patterns (Étape 2)

**Status:** Draft  
**Epic:** Epic 2 - Système de Simulation et Prédiction  
**Story Number:** 2.2.2

---

## Story

**As a** système de simulation,  
**I want** proportions alcool/nuit (Monte-Carlo) et patterns 4j/7j/60j (lecture + génération),  
**so that** les features hebdo incluent ces proportions et les patterns modulent les régimes et matrices.

---

## Acceptance Criteria

1. Monte-Carlo journalier proportions alcool/nuit par type (3×2 = 6) ; agrégation hebdomadaire.
2. **Patterns de base** : lecture depuis `data/patterns/` (ex. **4j** ou **7j**). Ces patterns **génèrent** des patterns futurs qui **modifient** les matrices 7j et 60j.
3. **7j** : `Ψ_court(t)` ; si trop d'incidents d'une certaine gravité (ex. ≥4 moyen) → pattern de probabilité légèrement plus élevée.
4. **60j** : structure type **20 jours hausse, 20 jours sous la moyenne, 20 jours re-hausse** pour ajouter chaos / variabilité (ML).
5. Mise à jour matrices de transition selon patterns activés (×3.5 court-terme, Crise si `Φ_long > 15`, etc.).
6. Tests unitaires : proportions [0,1], patterns, modification matrices.

---

## Integration Verification

IV1: Proportions cohérentes ; patterns modifient les régimes.  
IV2: Lecture depuis `data/patterns/` (format défini) OK.

---

## Tasks / Subtasks

- [ ] Implémenter Monte-Carlo journalier proportions alcool/nuit (3×2 = 6)
- [ ] Implémenter agrégation hebdomadaire proportions
- [ ] Implémenter lecture patterns depuis `data/patterns/` (4j, 7j, 60j)
- [ ] Implémenter génération patterns futurs (modification matrices)
- [ ] Implémenter pattern 7j (`Ψ_court(t)`) avec seuil gravité
- [ ] Implémenter pattern 60j (structure 20+20+20 jours)
- [ ] Implémenter mise à jour matrices de transition selon patterns
- [ ] Tests : proportions [0,1], patterns, modification matrices

---

## Dev Notes

### Architecture Context

- **Proportions alcool/nuit** : Calcul Monte-Carlo journalier, agrégation hebdomadaire (FR2)
- **Patterns** : Lecture depuis `data/patterns/` + génération patterns futurs
- **Pattern 7j** : Court-terme, modulation selon gravité incidents
- **Pattern 60j** : Long-terme, structure 20+20+20 jours pour variabilité ML
- **Matrices de transition** : Modifiables selon patterns activés

### Source Tree

```
src/core/patterns/
├── pattern_loader.py        # Interface chargement patterns
├── pattern_4j.py            # Pattern court-terme 4j
├── pattern_7j.py            # Pattern court-terme 7j
└── pattern_60j.py           # Pattern long-terme 60j

data/patterns/               # Fichiers patterns JSON
```

### Dependencies

- Patterns : Fichiers JSON dans `data/patterns/`
- Matrices de transition : Story 2.2.1

### Testing Standards

- Tests unitaires : Proportions [0,1], patterns, modification matrices
- Framework : pytest
- Emplacement : `tests/core/patterns/`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 28 Jan 2026 | 1.0 | Création story | PM |
