# Story 2.3.2 : Entraînement modèles ML — régression et classification

**Status:** Draft  
**Epic:** Epic 2 - Système de Simulation et Prédiction  
**Story Number:** 2.3.2

---

## Story

**As a** système ML,  
**I want** entraîner 4 modèles ML (2 régression, 2 classification) sur données préparées,  
**so that** des prédictions peuvent être faites avec interprétabilité.

---

## Acceptance Criteria

1. **2 régression** : **Random Forest**, **Ridge** (ou 2 parmi RF, Ridge, etc. ; pas de régression linéaire simple).
2. **2 classification** : **Logistic Regression**, **XGBoost** (ou 2 parmi LogReg, XGBoost, etc.).
3. Entraînement sur DataFrame final (90 features, labels)
4. Calcul métriques: MAE, RMSE, R² (régression), Accuracy, Precision, Recall, F1 (classification)
5. Hyperparamètres: Phase 2 (valeurs fixes au début)
6. Sauvegarde modèles avec métadonnées: Nom algorithme, numéro entraînement, paramètres génération données
7. Format sauvegarde: `{algo}_{numero_entrainement}_{params}.joblib` dans `models/regression/` ou `models/classification/`
8. Tests unitaires validant entraînement, métriques, sauvegarde

---

## Integration Verification

IV1: Vérifier que les modèles peuvent être entraînés sans erreur (données valides)  
IV2: Vérifier que les métriques sont calculées correctement (comparaison avec valeurs attendues)  
IV3: Vérifier que les modèles sauvegardés peuvent être rechargés et utilisés pour prédiction

---

## Tasks / Subtasks

- [ ] Implémenter entraînement Random Forest (régression)
- [ ] Implémenter entraînement Ridge (régression)
- [ ] Implémenter entraînement Logistic Regression (classification)
- [ ] Implémenter entraînement XGBoost (classification)
- [ ] Implémenter calcul métriques régression (MAE, RMSE, R²)
- [ ] Implémenter calcul métriques classification (Accuracy, Precision, Recall, F1)
- [ ] Implémenter sauvegarde modèles avec métadonnées (joblib)
- [ ] Implémenter format sauvegarde (`{algo}_{numero}_{params}.joblib`)
- [ ] Tests : entraînement, métriques, sauvegarde

---

## Dev Notes

### Architecture Context

- **Modèles ML** : 2 régression (RF, Ridge) + 2 classification (LogReg, XGBoost) (FR7, FR19)
- **Features** : 90 features (1 central 18 + 4 voisins 18×4) (Story 2.3.1)
- **Labels** : Score (régression) ou Classes (classification) (Story 2.2.6)
- **Entraînement** : Une fois les 50 runs terminés (FR23)
- **Métriques** : MAE, RMSE, R² (régression), Accuracy, Precision, Recall, F1 (classification) (NFR9)
- **Sauvegarde** : Format `{algo}_{numero}_{params}.joblib` dans `models/regression/` ou `models/classification/` (FR9)

### Source Tree

```
src/services/
└── ml_service.py            # Entraînement et prédiction ML

data/models/
├── regression/
│   ├── random_forest_001_params.joblib
│   └── ridge_001_params.joblib
└── classification/
    ├── logistic_regression_001_params.joblib
    └── xgboost_001_params.joblib
```

### Dependencies

- scikit-learn : Random Forest, Ridge, Logistic Regression
- XGBoost : XGBoost classifier
- joblib : Sauvegarde modèles
- Features/labels : Story 2.3.1

### Testing Standards

- Tests unitaires : Entraînement, métriques, sauvegarde
- Tests ML : Métriques (MAE, RMSE, R², Accuracy, F1) + **matrices de confusion pour classification** + tests de prédiction automatiques (prédiction vs réalité)
- Framework : pytest
- Emplacement : `tests/services/test_ml_service.py`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 28 Jan 2026 | 1.0 | Création story | PM |
