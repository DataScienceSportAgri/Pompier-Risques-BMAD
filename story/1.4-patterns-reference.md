# Story 1.4 : Fichier de r√©f√©rence patterns Paris

**Status:** Ready for Review  
**Epic:** Epic 1 - Pr√©-calculs  
**Story Number:** 1.4

**√âpics Status:**
- ‚úÖ Epic 1 : Fichier de r√©f√©rence patterns (Termin√©)
- ‚úÖ Epic 2 : Format patterns 4j, 7j, 60j (Termin√©)
- ‚úÖ Epic 3 : Exemples et validation (Termin√©)
- üîÑ Epic 4 : Matrices de corr√©lation et patterns dynamiques (En cours - Story 1.4.4)

---

## Story

**As a** d√©veloppeur,  
**I want** un fichier de r√©f√©rence documentant le format des patterns Paris,  
**so that** les stories 1.3 et 2.2.2 peuvent utiliser ces patterns correctement.

---

## Acceptance Criteria

1. **Fichier de r√©f√©rence** : Document (markdown ou JSON schema) d√©finissant le format exact des fichiers patterns Paris dans `data/patterns/`.
2. **Format patterns** : Structure JSON claire pour patterns 4j, 7j, 60j.
3. **Exemples** : Fichiers patterns d'exemple pour chaque type (4j, 7j, 60j).
4. **Documentation** : Description de chaque champ, valeurs attendues, contraintes.
5. **Validation** : Sch√©ma de validation (JSON schema ou Pydantic) pour v√©rifier format patterns.
6. Tests : Validation format patterns, chargement exemples.

---

## Integration Verification

IV1: Patterns d'exemple charg√©s sans erreur par Story 1.3 et 2.2.2.  
IV2: Format patterns document√© et utilisable.

---

## Tasks / Subtasks

- [x] Cr√©er fichier de r√©f√©rence patterns (markdown ou JSON schema)
- [x] D√©finir format patterns 4j (structure JSON)
- [x] D√©finir format patterns 7j (structure JSON)
- [x] D√©finir format patterns 60j (structure JSON)
- [x] Cr√©er fichiers patterns d'exemple (4j, 7j, 60j)
- [x] Documenter chaque champ (description, valeurs attendues, contraintes)
- [x] Cr√©er sch√©ma validation (JSON schema ou Pydantic)
- [x] Tests : validation format, chargement exemples

---

## Dev Notes

### Architecture Context

- **Patterns Paris** : Utilis√©s par Story 1.3 (vecteurs statiques) et Story 2.2.2 (patterns 4j/7j/60j)
- **Format** : JSON pour faciliter lecture/√©criture
- **R√©f√©rence** : Document centralis√© pour toutes les stories utilisant patterns

### Source Tree

```
docs/
‚îú‚îÄ‚îÄ philosophy-patterns-json.md  # Philosophie format patterns JSON
‚îî‚îÄ‚îÄ patterns-reference.md         # Fichier de r√©f√©rence patterns (ce document)

data/patterns/
‚îú‚îÄ‚îÄ pattern_4j_example.json      # Exemple pattern 4j
‚îú‚îÄ‚îÄ pattern_7j_example.json      # Exemple pattern 7j
‚îî‚îÄ‚îÄ pattern_60j_example.json     # Exemple pattern 60j (√† cr√©er)

examples/
‚îî‚îÄ‚îÄ pickle_format_example.py     # Exemple utilisation format pickle standardis√©
```

### Format patterns (exemple)

```json
{
  "pattern_type": "4j",
  "microzone_id": "mz_001",
  "type_incident": "agressions",
  "gravite": "moyen",
  "probabilite_base": 0.15,
  "facteurs_modulation": {
    "saison": {"hiver": 0.9, "ete": 1.1, "intersaison": 1.2},
    "regime": {"stable": 1.0, "deterioration": 1.3, "crise": 1.8}
  }
}
```

### Testing Standards

- Tests unitaires : Validation format, chargement exemples
- Tests de validation : Format patterns respect√©
- Framework : pytest
- Emplacement : `tests/data/patterns/`

---

## Related Stories

- **Story 1.4.4** : Matrices de corr√©lation et patterns dynamiques J‚ÜíJ+1 (Epic 4)

---

## File List

| Fichier | Modifi√© / Cr√©√© |
|---------|----------------|
| `docs/patterns-reference.md` | Cr√©√© |
| `scripts/validate_patterns.py` | Cr√©√© |
| `scripts/precompute_vectors_static.py` | Modifi√© (format ref, `_extract_base_probs_from_ref`) |
| `scripts/run_precompute.py` | Modifi√© (import matrices, `run_validate_patterns`, `--validate-patterns`) |
| `tests/data/patterns/test_validate_patterns.py` | Cr√©√© |
| `tests/scripts/test_run_precompute.py` | Modifi√© (imports, test `run_validate_patterns`) |
| `requirements-precompute.txt` | Modifi√© (pydantic) |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 28 Jan 2026 | 1.0 | Cr√©ation story | PM |
| 28 Jan 2026 | 1.1 | √âpics 1-3 termin√©s, Epic 4 cr√©√© (Story 1.4.4) | PM |
| 29 Jan 2026 | 1.2 | Impl√©mentation Story 1.4 : patterns-reference, validate_patterns, run_precompute, tests | Dev |
